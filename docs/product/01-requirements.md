# 01 要件定義

## 1. 目的
OpsHubは、社内/チーム運用に必要な「チケット管理・監査・通知・権限」を**最小コストで運用**できる業務アプリである。  
設計上の最重要方針は以下。

- **安定性優先**: SPA分離を避け、Laravelモノリスで完結
- **AI実装成功率優先**: 依存を絞り、定番構成・一本道の実装導線を作る
- **運用しやすさ**: ログ/監視/ジョブ/権限を早期に組み込む
- **本番寄せDocker**: 開発/CI/本番の差分を最小化

## 2. スコープ
### 2.1 MVP（必須）
- マルチテナント
  - テナント作成/一覧/編集（管理者）
  - リクエストごとにテナント文脈を確定（TenantContext）
- ユーザー/組織
  - Department/TeamのCRUD
  - Teamへのユーザー割当（UserTeam）
- 認証
  - メール+パスワード（Breeze想定）
- RBAC（ロール/権限）
  - 組織内ロール（例: Admin/Manager/Agent/Viewer）
  - 画面/操作単位の権限制御
- チケット管理
  - チケット作成/一覧/詳細/更新
  - タイプ（Incident/Request/Change/Task）
  - 状態（NEW/TRIAGED/IN_PROGRESS/PENDING/RESOLVED/CLOSED）
  - 担当者アサイン、コメント/イベント履歴
- 監査ログ
  - 重要操作（作成/更新/削除/権限変更/状態遷移）を記録
- 通知（最低限）
  - チケット作成/アサイン/状態変更の通知（DB通知 or メール）
- ダッシュボード
  - 件数集計（状態別/担当別/期間）

### 2.2 拡張（Nice to have）
- SLA/優先度、カスタムフィールド
- 承認フロー（Changeの承認）
- 監査ログの検索/エクスポート
- 添付ファイル（S3想定）
- 外部連携（Slack/Teams）
- 多言語/テーマ切替

## 3. ユーザ種別
- Tenant Owner（テナント作成/課金/ユーザー管理）
- Tenant Admin（権限/組織設定）
- Manager（チーム運用、閲覧/更新）
- Agent（チケット対応）
- Viewer（閲覧のみ）

## 4. 非機能要件
### 4.1 可用性
- 個人/小規模: 99.5%目安（初期）
- 主要機能はDB/Redisの一時停止に対して明確なエラーを返す（無限リトライ禁止）

### 4.2 セキュリティ
- CSRF/セッション管理（Laravel標準）
- パスワードはハッシュ（Laravel標準）
- RBACで保護（UI/サーバ両方で）
- 監査ログは改ざんされにくい設計（追記型、論理削除禁止）
- 本番は `APP_DEBUG=false`
- シークレットはAWS Secrets Manager/SSMへ移行可能に

### 4.3 性能
- 一覧はページング必須
- N+1回避（Eager load）
- 集計はキャッシュ/非同期化（拡張）

### 4.4 運用性
- すべてのリクエスト/ジョブに Request-ID（相関ID）を付与
- ログは stdout/stderr へ（コンテナ集約）
- エラーはSentry等で重複排除（推奨）
- CIで `lint + test + migrate` を必須に

## 5. 受け入れ条件（例）
- Adminがテナント/組織/ユーザ/ロールを管理できる
- Agentがチケットを作成し、担当を付け、状態遷移できる
- 重要操作が監査ログで追える（誰が/いつ/何を/どのIDに対して）
- docker compose up → 既定の初期化手順で起動できる（再現性）
